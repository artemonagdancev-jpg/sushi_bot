<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–°—É—à—ñ –ë–æ—Ç</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 16px;
      margin: 0;
      background: #fff;
      max-width: 500px;
      margin: 0 auto;
    }
    .screen { display: none; }
    .active { display: block; }
    .category-btn {
      display: block;
      width: 100%;
      padding: 14px;
      margin: 8px 0;
      background: #ff6347;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 18px;
      cursor: pointer;
    }
    .slider img {
      width: 100%;
      max-height: 300px;
      object-fit: cover;
      border-radius: 12px;
      margin: 10px 0;
    }
    .controls {
      display: flex;
      justify-content: space-between;
      margin: 20px 0;
    }
    .ctrl-btn {
      padding: 10px 16px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background: #f0f0f0;
      cursor: pointer;
    }
    .order-btn {
      background: #2e8b57 !important;
      color: white;
    }
    .description {
      background: #f9f9f9;
      padding: 12px;
      border-radius: 8px;
      margin-top: 15px;
    }
    button.back {
      width: 100%;
      padding: 12px;
      margin-top: 15px;
      background: #6c757d;
      color: white;
      border: none;
      border-radius: 8px;
    }
    h2 { text-align: center; }
  </style>
</head>
<body>

<!-- –ï–∫—Ä–∞–Ω 1: –í–∏–±—ñ—Ä –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó -->
<div id="screen-menu" class="screen active">
  <h2>üçΩÔ∏è –û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</h2>
  <button class="category-btn" onclick="loadCategory('sets')">–°–µ—Ç–∏</button>
  <button class="category-btn" onclick="loadCategory('sushi')">–°—É—à—ñ</button>
  <button class="category-btn" onclick="loadCategory('drinks')">–ù–∞–ø–æ—ó</button>
</div>

<!-- –ï–∫—Ä–∞–Ω 2: –°–ª–∞–π–¥–µ—Ä -->
<div id="screen-slider" class="screen">
  <div class="slider">
    <img id="item-image" src="" alt="–°—Ç—Ä–∞–≤–∞">
  </div>
  <div class="controls">
    <button class="ctrl-btn" id="prev" onclick="prevItem()">‚óÄ</button>
    <button class="ctrl-btn order-btn" onclick="orderCurrent()">‚úÖ –ó–∞–º–æ–≤–∏—Ç–∏</button>
    <button class="ctrl-btn" id="next" onclick="nextItem()">‚ñ∂</button>
  </div>
  <div class="description">
    <h3 id="item-name"></h3>
    <p><strong id="item-price"></strong></p>
    <p id="item-desc"></p>
  </div>
  <button class="back" onclick="goBack()">‚Üê –ù–∞–∑–∞–¥ –¥–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π</button>
</div>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbzVGbe8K48FStFAj94HYh-yunTo2ckczl8X0vVU0GlMH_lEB_uQTPGMix9O36zKKs-Ocw/exec";
  const ORDER_URL = API_URL; // –±—É–¥–µ–º–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ç–æ–π —Å–∞–º–∏–π endpoint –¥–ª—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è

  let currentCategory = [];
  let currentIndex = 0;

  function showScreen(id) {
    document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  function goBack() {
    showScreen('screen-menu');
  }

  function loadCategory(category) {
    fetch(API_URL + "?category=" + category)
      .then(res => res.json())
      .then(data => {
        if (data.error) throw new Error(data.error);
        currentCategory = data;
        currentIndex = 0;
        if (currentCategory.length > 0) {
          showItem(0);
          showScreen('screen-slider');
        } else {
          alert("–ö–∞—Ç–µ–≥–æ—Ä—ñ—è –ø–æ—Ä–æ–∂–Ω—è");
        }
      })
      .catch(err => {
        alert("–ü–æ–º–∏–ª–∫–∞: " + err.message);
      });
  }

  function showItem(index) {
    const item = currentCategory[index];
    document.getElementById('item-image').src = item.image || "https://via.placeholder.com/400x300?text=–§–æ—Ç–æ+–≤—ñ–¥—Å—É—Ç–Ω—î";
    document.getElementById('item-name').innerText = item.name || "‚Äî";
    document.getElementById('item-price').innerText = item.price ? item.price + " –≥—Ä–Ω" : "";
    document.getElementById('item-desc').innerText = item.description || "–û–ø–∏—Å –≤—ñ–¥—Å—É—Ç–Ω—ñ–π";

    document.getElementById('prev').disabled = (index === 0);
    document.getElementById('next').disabled = (index === currentCategory.length - 1);
  }

  function prevItem() {
    if (currentIndex > 0) {
      currentIndex--;
      showItem(currentIndex);
    }
  }

  function nextItem() {
    if (currentIndex < currentCategory.length - 1) {
      currentIndex++;
      showItem(currentIndex);
    }
  }

  function orderCurrent() {
    const item = currentCategory[currentIndex];
    const name = item.name;
    const phone = prompt("–í–∞—à–µ —ñ–º‚Äô—è —Ç–∞ —Ç–µ–ª–µ—Ñ–æ–Ω (—á–µ—Ä–µ–∑ –∫–æ–º—É):", "–Ü–º‚Äô—è, +380...");
    const address = prompt("–ê–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏:", "–≤—É–ª. –õ—ñ—Å–æ–≤–∞, 10");

    if (!phone || !address) {
      Telegram.WebApp?.showAlert("–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è —Å–∫–∞—Å–æ–≤–∞–Ω–æ.");
      return;
    }

    const [userName, userPhone] = phone.split(",").map(s => s.trim());

    // –§–æ—Ä–º–∞—Ç: items=ID:1
    const url = `${ORDER_URL}?items=${item.id}:1&name=${encodeURIComponent(userName)}&phone=${encodeURIComponent(userPhone)}&address=${encodeURIComponent(address)}`;

    fetch(url)
      .then(() => {
        Telegram.WebApp?.showPopup({
          title: "‚úÖ –ó–∞–º–æ–≤–ª–µ–Ω–æ!",
          message: `–í–∏ –∑–∞–º–æ–≤–∏–ª–∏:\n${item.name}\n\n–û—á—ñ–∫—É–π—Ç–µ –¥–∑–≤—ñ–Ω–∫–∞!`
        }, () => {
          Telegram.WebApp?.close();
        });
      })
      .catch(err => {
        Telegram.WebApp?.showAlert("–ü–æ–º–∏–ª–∫–∞: " + err.message);
      });
  }
</script>
</body>
</html>
