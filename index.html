<!DOCTYPE html>
<html>
<head>
  <title>–°—É—à—ñ –ë–æ—Ç</title>
  <style>
    body { font-family: Arial; padding: 20px; max-width: 600px; margin: 0 auto; }
    .item { 
      margin: 15px 0; padding: 12px; border: 1px solid #ddd; border-radius: 8px; display: flex; align-items: center; 
    }
    .cart { 
      background: #f0fff0; padding: 16px; margin-top: 20px; border-radius: 8px; 
    }
    input, button { 
      padding: 8px; margin: 5px 0; border: 1px solid #ccc; border-radius: 4px; 
    }
    .cart-item { 
      display: flex; 
      align-items: center; 
      justify-content: space-between; 
      margin: 8px 0; 
      padding: 8px; 
      background: white; 
      border-radius: 6px; 
    }
    .qty-controls { 
      display: flex; 
      align-items: center; 
      gap: 8px; 
    }
    .qty-btn { 
      width: 30px; 
      height: 30px; 
      font-weight: bold; 
      background: #f1f1f1; 
      border: 1px solid #ccc; 
      border-radius: 4px; 
      cursor: pointer; 
    }
    .qty-value { 
      min-width: 24px; 
      text-align: center; 
    }
    button.main-btn { 
      background: #ff6347; 
      color: white; 
      border: none; 
      cursor: pointer; 
      width: 100%; 
      padding: 10px; 
      font-size: 16px; 
      margin-top: 10px;
    }
    button.main-btn:hover { background: #e0553b; }
    img { width: 80px; height: 80px; object-fit: cover; border-radius: 6px; margin-right: 15px; }
  </style>
</head>
<body>
  <h1>üç£ –ú–µ–Ω—é –°–µ—Ç—ñ–≤</h1>
  <div id="menu"></div>

  <div class="cart">
    <h2>üõí –ö–æ—à–∏–∫</h2>
    <div id="cart-items"></div>

    <h3>–í–∞—à—ñ –¥–∞–Ω—ñ:</h3>
    <input type="text" id="name" placeholder="–Ü–º‚Äô—è (–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ)" required><br>
    <input type="tel" id="phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω (–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ)" required><br>
    <input type="text" id="address" placeholder="–ê–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ (–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ)" required><br>

    <a id="orderLink" href="#" style="display:none;">
      <button class="main-btn">‚úÖ –ó–∞–º–æ–≤–∏—Ç–∏</button>
    </a>
  </div>

  <script>
    let cart = [];
    let menuMap = {};
    const API_URL = "https://script.google.com/macros/s/AKfycbwVQoNcHZI8OhW9vfsBbxfBIZzCj6KoOwZyZfP18_YAOJsUGAjwmnUarqg_ctnVCsyAtg/exec";

    fetch(API_URL)
      .then(res => res.json())
      .then(menu => {
        menu.forEach(item => {
          menuMap[item.id] = item.name;
        });

        menu.forEach(item => {
          const el = document.createElement("div");
          el.className = "item";
          el.innerHTML = `
            <img src="${item.image}" alt="${item.name}" loading="lazy">
            <div>
              <strong>${item.name}</strong><br>
              ${item.price} –≥—Ä–Ω<br>
              <button onclick="addToCart(${item.id})">‚ûï –î–æ–¥–∞—Ç–∏</button>
            </div>
          `;
          document.getElementById("menu").appendChild(el);
        });
      });

    function addToCart(id) {
      const exists = cart.find(i => i.id == id);
      if (exists) {
        exists.qty++;
      } else {
        cart.push({ id, qty: 1 });
      }
      renderCart();
    }

    function updateQty(id, delta) {
      const item = cart.find(i => i.id == id);
      if (item) {
        item.qty += delta;
        if (item.qty <= 0) {
          // –í–∏–¥–∞–ª—è—î–º–æ, —è–∫—â–æ 0 –∞–±–æ –º–µ–Ω—à–µ
          cart = cart.filter(i => i.id != id);
        }
        renderCart();
      }
    }

    function renderCart() {
      const div = document.getElementById("cart-items");
      const link = document.getElementById("orderLink");
      
      if (cart.length === 0) {
        div.innerHTML = "<em>–ö–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π</em>";
        link.style.display = "none";
        return;
      }

      div.innerHTML = cart.map(i => {
        const name = menuMap[i.id] || `ID ${i.id}`;
        return `
          <div class="cart-item">
            <span>‚úÖ ${name}</span>
            <div class="qty-controls">
              <button class="qty-btn" onclick="updateQty(${i.id}, -1)">‚Äì</button>
              <span class="qty-value">${i.qty}</span>
              <button class="qty-btn" onclick="updateQty(${i.id}, 1)">+</button>
            </div>
          </div>
        `;
      }).join("");

      link.style.display = "block";
    }

    document.getElementById("orderLink").addEventListener("click", function(e) {
      const name = document.getElementById("name").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const address = document.getElementById("address").value.trim();
      
      if (!name || !phone || !address) {
        alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –ø–æ–ª—è!");
        e.preventDefault();
        return;
      }

      const itemsStr = cart.map(i => `${i.id}:${i.qty}`).join(",");
      const url = API_URL + 
                  "?items=" + encodeURIComponent(itemsStr) +
                  "&name=" + encodeURIComponent(name) +
                  "&phone=" + encodeURIComponent(phone) +
                  "&address=" + encodeURIComponent(address);
      
      this.href = url;
    });
  </script>
</body>
</html>


