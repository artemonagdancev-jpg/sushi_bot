<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–°—É—à—ñ –ë–æ—Ç</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      padding: 16px;
      margin: 0;
      background: #fff;
      max-width: 500px;
      margin: 0 auto;
    }
    .screen { display: none; }
    .active { display: block; }
    .category-btn {
      display: block;
      width: 100%;
      padding: 14px;
      margin: 8px 0;
      background: #ff6347;
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 18px;
      cursor: pointer;
    }
    .slider img {
      width: 100%;
      max-height: 300px;
      object-fit: cover;
      border-radius: 12px;
      margin: 10px 0;
    }
    .controls {
      display: flex;
      justify-content: space-between;
      margin: 20px 0;
    }
    .ctrl-btn {
      padding: 10px 16px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background: #f0f0f0;
      cursor: pointer;
    }
    .order-btn {
      background: #2e8b57 !important;
      color: white;
    }
    .description {
      background: #f9f9f9;
      padding: 12px;
      border-radius: 8px;
      margin-top: 15px;
    }
    button.back, button.submit {
      width: 100%;
      padding: 12px;
      margin-top: 15px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }
    button.back { background: #6c757d; color: white; }
    button.submit { background: #28a745; color: white; }

    input, textarea {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
    }

    h2 { text-align: center; }
  </style>
</head>
<body>

<!-- –ï–∫—Ä–∞–Ω 1: –í–∏–±—ñ—Ä –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó -->
<div id="screen-menu" class="screen active">
  <h2>üçΩÔ∏è –û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</h2>
  <button class="category-btn" onclick="loadCategory('sets')">–°–µ—Ç–∏</button>
  <button class="category-btn" onclick="loadCategory('sushi')">–°—É—à—ñ</button>
  <button class="category-btn" onclick="loadCategory('drinks')">–ù–∞–ø–æ—ó</button>
</div>

<!-- –ï–∫—Ä–∞–Ω 2: –°–ª–∞–π–¥–µ—Ä -->
<div id="screen-slider" class="screen">
  <div class="slider">
    <img id="item-image" src="" alt="–°—Ç—Ä–∞–≤–∞">
  </div>
  <div class="controls">
    <button class="ctrl-btn" id="prev" onclick="prevItem()">‚óÄ</button>
    <button class="ctrl-btn order-btn" onclick="showOrderForm()">‚úÖ –ó–∞–º–æ–≤–∏—Ç–∏</button>
    <button class="ctrl-btn" id="next" onclick="nextItem()">‚ñ∂</button>
  </div>
  <div class="description">
    <h3 id="item-name"></h3>
    <p><strong id="item-price"></strong></p>
    <p id="item-desc"></p>
  </div>
  <button class="back" onclick="goBack()">‚Üê –ù–∞–∑–∞–¥ –¥–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ–π</button>
</div>

<!-- –ï–∫—Ä–∞–Ω 3: –§–æ—Ä–º–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è -->
<div id="screen-form" class="screen">
  <h2>üì± –í–∞—à—ñ –¥–∞–Ω—ñ</h2>
  <p id="form-item-name" style="text-align:center; font-weight:bold;"></p>
  <input type="text" id="form-name" placeholder="–í–∞—à–µ —ñ–º‚Äô—è (–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ)">
  <input type="tel" id="form-phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω (–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ)">
  <textarea id="form-address" placeholder="–ê–¥—Ä–µ—Å–∞ –¥–æ—Å—Ç–∞–≤–∫–∏ (–æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ)" rows="2"></textarea>
  <button class="submit" onclick="submitOrder()">‚úÖ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
  <button class="back" onclick="showScreen('screen-slider')">‚Üê –ù–∞–∑–∞–¥ –¥–æ —Å—Ç—Ä–∞–≤–∏</button>
</div>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbzVGbe8K48FStFAj94HYh-yunTo2ckczl8X0vVU0GlMH_lEB_uQTPGMix9O36zKKs-Ocw/exec";
  let currentCategory = [];
  let currentIndex = 0;
  let selectedItem = null;

  function showScreen(id) {
    document.querySelectorAll('.screen').forEach(el => el.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }

  function goBack() {
    showScreen('screen-menu');
  }

  function loadCategory(category) {
    fetch(API_URL + "?category=" + category)
      .then(res => res.json())
      .then(data => {
        if (data.error) throw new Error(data.error);
        currentCategory = data;
        currentIndex = 0;
        if (currentCategory.length > 0) {
          showItem(0);
          showScreen('screen-slider');
        } else {
          alert("–ö–∞—Ç–µ–≥–æ—Ä—ñ—è –ø–æ—Ä–æ–∂–Ω—è");
        }
      })
      .catch(err => {
        alert("–ü–æ–º–∏–ª–∫–∞: " + err.message);
      });
  }

  function showItem(index) {
    const item = currentCategory[index];
    document.getElementById('item-image').src = item.image || "https://via.placeholder.com/400x300?text=–§–æ—Ç–æ+–≤—ñ–¥—Å—É—Ç–Ω—î";
    document.getElementById('item-name').innerText = item.name || "‚Äî";
    document.getElementById('item-price').innerText = item.price ? item.price + " –≥—Ä–Ω" : "";
    document.getElementById('item-desc').innerText = item.description || "–û–ø–∏—Å –≤—ñ–¥—Å—É—Ç–Ω—ñ–π";
    selectedItem = item;

    document.getElementById('prev').disabled = (index === 0);
    document.getElementById('next').disabled = (index === currentCategory.length - 1);
  }

  function prevItem() {
    if (currentIndex > 0) {
      currentIndex--;
      showItem(currentIndex);
    }
  }

  function nextItem() {
    if (currentIndex < currentCategory.length - 1) {
      currentIndex++;
      showItem(currentIndex);
    }
  }

  function showOrderForm() {
    document.getElementById('form-item-name').innerText = "–ó–∞–º–æ–≤–ª—è—î—Ç–µ: " + selectedItem.name;
    showScreen('screen-form');
  }

  function submitOrder() {
    const name = document.getElementById('form-name').value.trim();
    const phone = document.getElementById('form-phone').value.trim();
    const address = document.getElementById('form-address').value.trim();

    if (!name || !phone || !address) {
      Telegram.WebApp?.showAlert("–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –ø–æ–ª—è!");
      return;
    }

    const url = `${API_URL}?items=${selectedItem.id}:1&name=${encodeURIComponent(name)}&phone=${encodeURIComponent(phone)}&address=${encodeURIComponent(address)}`;

    fetch(url)
      .then(() => {
        Telegram.WebApp?.showPopup({
          title: "‚úÖ –£—Å–ø—ñ—Ö!",
          message: `–ó–∞–º–æ–≤–ª–µ–Ω–æ:\n${selectedItem.name}\n\n–û—á—ñ–∫—É–π—Ç–µ –¥–∑–≤—ñ–Ω–∫–∞!`
        }, () => {
          Telegram.WebApp?.close();
        });
      })
      .catch(err => {
        Telegram.WebApp?.showAlert("–ü–æ–º–∏–ª–∫–∞: " + err.message);
      });
  }
</script>
</body>
</html>
