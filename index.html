<!DOCTYPE html>
<html>
<head>
  <title>–°—É—à—ñ –ë–æ—Ç</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    .item { 
      margin: 15px 0; 
      padding: 12px; 
      border: 1px solid #ddd; 
      border-radius: 8px; 
      display: flex; 
      align-items: center; 
    }
    .cart { 
      background: #f0fff0; 
      padding: 16px; 
      margin-top: 20px; 
      border-radius: 8px; 
    }
    button { 
      padding: 6px 12px; 
      background: #ff6347; 
      color: white; 
      border: none; 
      border-radius: 4px; 
      cursor: pointer; 
    }
    button:hover { background: #e0553b; }
    img { 
      width: 80px; 
      height: 80px; 
      object-fit: cover; 
      border-radius: 6px; 
      margin-right: 15px; 
      border: 1px solid #eee;
    }
  </style>
</head>
<body>
  <h1>üç£ –ú–µ–Ω—é –°–µ—Ç—ñ–≤</h1>
  <div id="menu"></div>

  <div class="cart">
    <h2>üõí –ö–æ—à–∏–∫</h2>
    <div id="cart-items"></div>
    <a id="orderLink" href="#" style="display:none; margin-top:10px;">
      <button>‚úÖ –ó–∞–º–æ–≤–∏—Ç–∏</button>
    </a>
  </div>

  <script>
    let cart = [];
    const API_URL = "https://script.google.com/macros/s/AKfycbzssbuflx7nQKsVJ0Vxz1j8qAYIYKCzBWXEyqb4CV6o3WUDftvA4yAjLMSZ2e8tP8a0jQ/exec";

    // –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –º–µ–Ω—é –∑ Google –¢–∞–±–ª–∏—Ü—ñ
    fetch(API_URL)
      .then(res => res.json())
      .then(menu => {
        menu.forEach(item => {
          const el = document.createElement("div");
          el.className = "item";
          // –î–æ–¥–∞—î–º–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∑—ñ —Å—Ç–æ–≤–ø—Ü—è "image"
          el.innerHTML = `
            <img src="${item.image}" alt="${item.name}" loading="lazy">
            <div>
              <strong>${item.name}</strong><br>
              ${item.price} –≥—Ä–Ω<br>
              <button onclick="addToCart(${item.id})">‚ûï –î–æ–¥–∞—Ç–∏</button>
            </div>
          `;
          document.getElementById("menu").appendChild(el);
        });
      })
      .catch(err => {
        alert("‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –º–µ–Ω—é: " + err.message);
      });

    function addToCart(id) {
      const exists = cart.find(i => i.id == id);
      if (exists) {
        exists.qty++;
      } else {
        cart.push({ id, qty: 1 });
      }
      renderCart();
    }

    function renderCart() {
      const div = document.getElementById("cart-items");
      const link = document.getElementById("orderLink");
      
      if (cart.length === 0) {
        div.innerHTML = "<em>–ö–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π</em>";
        link.style.display = "none";
        return;
      }

      // –§–æ—Ä–º–∞—Ç –¥–ª—è –ø–µ—Ä–µ–¥–∞—á—ñ: "1:2,3:1"
      const itemsStr = cart.map(i => `${i.id}:${i.qty}`).join(",");
      link.href = API_URL + "?items=" + encodeURIComponent(itemsStr);
      
      div.innerHTML = cart.map(i => 
        `<div>‚úÖ ID ${i.id}: ${i.qty} —à—Ç</div>`
      ).join("");
      
      link.style.display = "inline-block";
    }
  </script>
</body>
</html>
